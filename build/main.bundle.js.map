{"version":3,"sources":["webpack:///webpack/bootstrap cab34532b4d5c0bc4bf6","webpack:///./js/song-info.js","webpack:///./js/main.js","webpack:///./js/buffer-loader.js","webpack:///./js/kali.min.js","webpack:///./js/file-loader.js","webpack:///./js/song-file.js","webpack:///./js/number-recogniser.js","webpack:///./js/song-library.js","webpack:///./js/song-player.js","webpack:///./js/playlist-manager.js"],"names":["SongInfo","bpm","beatsPerBar","playbackRate","song","checkCompatibility","init","songUrlInput","document","getElementById","loadBySongUrlButton","filesInput","startBarkeepButton","loadingSampleProgressBar","jumpToBarNumberInput","jumpToBarButton","playSongButton","recognisedNumberDisplayElement","filesDropArea","body","songLibrary","playlistManager","jtmplModel","playlist","jtmpl","jtmplSongs","on","prop","updateSongInfos","addLoadedSong","songFile","info","getSongInfoByName","fileName","songModel","name","addSong","fileData","push","trigger","onclick","loadByUrl","value","then","loadFiles","files","i","f","loadByFileReader","onchange","evt","target","ondragover","dataTransfer","dropEffect","classList","add","ondragleave","remove","ondrop","selectedSong","filter","s","selected","alert","playSongByName","e","jumpToBar","Number","parseInt","onNumberRecognised","n","innerHTML","setTimeout","numberRecogniser","startListening","BufferLoader","progressCallback","undefined","Promise","resolve","reject","context","window","AudioContext","webkitAudioContext","decodeAudioData","buffer","stretchedBuffer","_stretch","console","error","numChannels","bestQuality","stretchSampleSize","inputBufferSize","getChannelData","length","outputBufferSize","Math","floor","outputAudioBuffer","createBuffer","sampleRate","channel","inputData","kali","Kali","setup","outputData","Float32Array","inputOffset","completedOffset","loopCount","flushed","output","subarray","min","dataToInput","input","process","flush","set","t","r","exports","id","loaded","call","m","c","p","is_initialized","sample_rate","channels","quick_search","factor","search","segment","overlap","process_size","samples_in","samples_out","segments_total","skip_total","o","input_fifo","output_fifo","prototype","difference","pow","tempo_best_overlap_position","overlap_buf","a","u","tempo_overlap","occupancy","read_ptr","write_ptr","write","read","max","segments_ms","segments_pow","searches_div","overlaps_div","h","l","ceil","reserve","setTempo","begin","end","typedArrayConstructor","clear","FileLoader","url","request","XMLHttpRequest","open","responseType","onload","urlParts","split","fileNamePart","fileNameWithoutExtension","response","onerror","status","statusText","send","file","reader","FileReader","result","readAsArrayBuffer","SongFile","NumberRecogniser","recognition","SpeechRecognition","webkitSpeechRecognition","lang","interimResults","maxAlternatives","start","onaudioend","onresult","results","ev","candidateNumber","transcript","isNaN","isFinite","isLocalhost","location","host","startsWith","isChrome","test","navigator","userAgent","vendor","protocol","SongLibrary","songInfos","retrieveFromStorage","get","songs","fromObject","persistToStorage","json","JSON","stringify","localStorage","setItem","jsonFromStorage","getItem","Map","parse","infos","SongPlayer","bufferRate","secondsPerBar","barNumber","stop","source","createBufferSource","connect","destination","startTime","getStartTimeInSeconds","currentSource","startTimeInSeconds","PlaylistManager","fileDataMap","bufferMap","songName","songInfo","bufferPlaybackRate","bufferKey","has","_playBuffer","loadBuffer","log","currentSongPlayer","play","songPlayer"],"mappings":"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","file":"main.bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 1);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap cab34532b4d5c0bc4bf6","export default class SongInfo {\r\n    constructor(bpm, beatsPerBar, playbackRate) {\r\n        this.bpm = bpm;\r\n        this.beatsPerBar = beatsPerBar || 4;\r\n        this.playbackRate = playbackRate || 100;\r\n    }\r\n\r\n    static fromObject(song) {\r\n        return new SongInfo(song.bpm, song.beatsPerBar, song.playbackRate);\r\n    }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./js/song-info.js","import BufferLoader from './buffer-loader'\r\nimport FileLoader from './file-loader'\r\nimport NumberRecogniser from './number-recogniser'\r\nimport PlaylistManager from './playlist-manager'\r\nimport SongInfo from './song-info'\r\nimport SongLibrary from './song-library'\r\nimport SongPlayer from './song-player'\r\n\r\nif (NumberRecogniser.checkCompatibility()) {\r\n    init();\r\n}\r\n\r\nfunction init() {\r\n    let songUrlInput = document.getElementById('songUrl');\r\n    let loadBySongUrlButton = document.getElementById('loadBySongUrl');\r\n    let filesInput = document.getElementById('files');\r\n    let startBarkeepButton = document.getElementById('startBarkeep');\r\n    let loadingSampleProgressBar = document.getElementById('loadingSampleProgressBar');\r\n    let jumpToBarNumberInput = document.getElementById('jumpToBarNumber');\r\n    let jumpToBarButton = document.getElementById('jumpToBarButton');\r\n    let playSongButton = document.getElementById('playSongButton');\r\n    let recognisedNumberDisplayElement = document.getElementById('recognisedNumberDisplay');\r\n    let filesDropArea = document.body;\r\n\r\n    let songLibrary = new SongLibrary();\r\n    let playlistManager = new PlaylistManager(songLibrary);\r\n    let jtmplModel = { playlist: [] };\r\n    jtmpl('#songsContainer', '#songTemplate', jtmplModel);\r\n\r\n    var jtmplSongs = jtmpl('#songsContainer');\r\n    jtmplSongs.on('update', (prop) => {\r\n        if (prop === 'playlist') {\r\n            songLibrary.updateSongInfos(jtmplModel.playlist);\r\n        }\r\n    });\r\n\r\n    let addLoadedSong = (songFile) => {\r\n        let info = songLibrary.getSongInfoByName(songFile.fileName) || new SongInfo();\r\n        let songModel = {\r\n            name: songFile.fileName,\r\n            bpm: info.bpm,\r\n            beatsPerBar: info.beatsPerBar,\r\n            playbackRate: info.playbackRate\r\n        };\r\n\r\n        playlistManager.addSong(songFile.fileName, songFile.fileData);\r\n        jtmplModel.playlist.push(songModel);\r\n        jtmpl('#songsContainer').trigger('change', 'playlist');\r\n    }\r\n\r\n    loadBySongUrlButton.onclick = () => {\r\n        FileLoader.loadByUrl(songUrlInput.value)\r\n            .then(songFile => { addLoadedSong(songFile); });\r\n    }\r\n\r\n    let loadFiles = (files) => {\r\n        for (var i = 0, f; f = files[i]; i++) {\r\n            FileLoader.loadByFileReader(f)\r\n                .then(songFile => { addLoadedSong(songFile); });\r\n        }\r\n    }\r\n    filesInput.onchange = (evt) => {\r\n        loadFiles(evt.target.files);\r\n    }\r\n\r\n    filesDropArea.ondragover = (evt) => {\r\n        evt.dataTransfer.dropEffect = 'copy';\r\n        filesDropArea.classList.add('droppable');\r\n        return false;\r\n    }\r\n    filesDropArea.ondragleave = () => {\r\n        filesDropArea.classList.remove('droppable');\r\n    }\r\n    filesDropArea.ondrop = (evt) => {\r\n        filesDropArea.classList.remove('droppable');\r\n        loadFiles(evt.dataTransfer.files);\r\n        return false;\r\n    }\r\n\r\n    // wire up manual controls\r\n    playSongButton.onclick = () => {\r\n        let selectedSong = jtmplModel.playlist.filter(s => s.selected)[0];\r\n        if (!selectedSong) {\r\n            alert('Please select a song!');\r\n            return false;\r\n        }\r\n        playlistManager.playSongByName(selectedSong.name);\r\n    }\r\n    jumpToBarButton.onclick = (e) => {\r\n        playlistManager.jumpToBar(Number.parseInt(jumpToBarNumberInput.value));\r\n    };\r\n\r\n    startBarkeepButton.onclick = () => {\r\n        let onNumberRecognised = (n) => {\r\n            recognisedNumberDisplayElement.innerHTML = n;\r\n            recognisedNumberDisplayElement.classList.add('highlight');\r\n            setTimeout(() => { recognisedNumberDisplayElement.classList.remove('highlight'); }, 1000);\r\n            playlistManager.jumpToBar(n);\r\n        }\r\n        let numberRecogniser = new NumberRecogniser(onNumberRecognised);\r\n        numberRecogniser.startListening();\r\n    }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./js/main.js","import './kali.min.js'\r\n\r\nexport default class BufferLoader {\r\n\r\n    static loadBuffer(fileData, playbackRate = 1.0, progressCallback = undefined) {\r\n        return new Promise((resolve, reject) => {\r\n            let context = new (window.AudioContext || window.webkitAudioContext)();\r\n\r\n            context.decodeAudioData(fileData, (buffer) => {\r\n                let stretchedBuffer = BufferLoader._stretch(context, buffer, playbackRate, 2, false, progressCallback);\r\n                resolve(stretchedBuffer);\r\n            }, (e) => {\r\n                console.error(e);\r\n                reject();\r\n            });\r\n        });\r\n    }\r\n\r\n    static _stretch(context, buffer, playbackRate, numChannels, bestQuality, progressCallback) {\r\n\r\n        if (playbackRate === 1.0) {\r\n            return buffer;\r\n        }\r\n\r\n        let stretchSampleSize = 4096 * numChannels;\r\n\r\n        let inputBufferSize = buffer.getChannelData(0).length;\r\n        let outputBufferSize = Math.floor(inputBufferSize / playbackRate) + 1;\r\n\r\n        let outputAudioBuffer = context.createBuffer(numChannels, outputBufferSize, context.sampleRate);\r\n\r\n        for (let channel = 0; channel < numChannels; channel++) {\r\n            let inputData = buffer.getChannelData(channel);\r\n\r\n            let kali = new Kali(1);\r\n            kali.setup(context.sampleRate, playbackRate, !bestQuality);\r\n\r\n            let outputData = new Float32Array(outputBufferSize);\r\n\r\n            let inputOffset = 0;\r\n            let completedOffset = 0;\r\n            let loopCount = 0;\r\n            let flushed = false;\r\n\r\n            while (completedOffset < outputData.length) {\r\n                if (progressCallback && loopCount % 100 === 0) {\r\n                    progressCallback((completedOffset + outputBufferSize * channel) / (outputBufferSize * numChannels));\r\n                }\r\n\r\n                // Read stretched samples into outputData array\r\n                completedOffset += kali.output(outputData.subarray(completedOffset, Math.min(completedOffset + stretchSampleSize, outputData.length)));\r\n\r\n                if (inputOffset < inputData.length) {\r\n                    // If we have more data to write, write it\r\n                    let dataToInput = inputData.subarray(inputOffset, Math.min(inputOffset + stretchSampleSize, inputData.length));\r\n                    inputOffset += dataToInput.length;\r\n\r\n                    kali.input(dataToInput);\r\n                    kali.process();\r\n                } else if (!flushed) {\r\n                    kali.flush();\r\n                    flushed = true;\r\n                }\r\n\r\n                loopCount++;\r\n            }\r\n\r\n            outputAudioBuffer.getChannelData(channel).set(outputData);\r\n        }\r\n\r\n        if (progressCallback) {\r\n            // 100%\r\n            progressCallback(1);\r\n        }\r\n        return outputAudioBuffer;\r\n    }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./js/buffer-loader.js","!function(e){function t(i){if(r[i])return r[i].exports;var n=r[i]={exports:{},id:i,loaded:!1};return e[i].call(n.exports,n,n.exports,t),n.loaded=!0,n.exports}var r={};return t.m=e,t.c=r,t.p=\"\",t(0)}([function(e,t,r){e.exports=r(1)},function(e,t,r){function i(e){return Math.floor(e)}var n=r(2),s=function(){function e(){this.is_initialized=!1,this.sample_rate=44100,this.channels=0,this.quick_search=!1,this.factor=0,this.search=0,this.segment=0,this.overlap=0,this.process_size=0,this.samples_in=0,this.samples_out=0,this.segments_total=0,this.skip_total=0}return e}(),o=function(){function e(e){var t=new s;t.channels=e,t.input_fifo=new n(Float32Array),t.output_fifo=new n(Float32Array),this.t=t}return e.prototype.difference=function(e,t,r){for(var i=0,n=0,n=0;r>n;n++)i+=Math.pow(e[n]-t[n],2);return i},e.prototype.tempo_best_overlap_position=function(e,t){var r,i,n,s=e.overlap_buf,o=e.search+1>>>1,a=64,p=i=e.quick_search?o:0,u=this.difference(t.subarray(e.channels*p),s,e.channels*e.overlap),f=0;if(e.quick_search){do{for(f=-1;1>=f;f+=2)for(r=1;(4>r||64==a)&&(p=o+f*r*a,!(0>p||p>=e.search));r++)n=this.difference(t.subarray(e.channels*p),s,e.channels*e.overlap),u>n&&(u=n,i=p);o=i}while(a>>>=2)}else for(p=1;p<e.search;p++)n=this.difference(t.subarray(e.channels*p),s,e.channels*e.overlap),u>n&&(u=n,i=p);return i},e.prototype.tempo_overlap=function(e,t,r,i){var n=0,s=0,o=0,a=1/e.overlap;for(n=0;n<e.overlap;n++){var p=a*n,u=1-p;for(s=0;s<e.channels;s++,o++)i[o]=t[o]*u+r[o]*p}},e.prototype.process=function(){for(var e=this.t;e.input_fifo.occupancy()>=e.process_size;){var t,r;e.segments_total?(r=this.tempo_best_overlap_position(e,e.input_fifo.read_ptr(0)),this.tempo_overlap(e,e.overlap_buf,e.input_fifo.read_ptr(e.channels*r),e.output_fifo.write_ptr(e.overlap))):(r=e.search/2,e.output_fifo.write(e.input_fifo.read_ptr(e.channels*r,e.overlap),e.overlap)),e.output_fifo.write(e.input_fifo.read_ptr(e.channels*(r+e.overlap)),e.segment-2*e.overlap);var n=e.channels*e.overlap;e.overlap_buf.set(e.input_fifo.read_ptr(e.channels*(r+e.segment-e.overlap)).subarray(0,n)),e.segments_total++,t=i(e.factor*(e.segment-e.overlap)+.5),e.input_fifo.read(null,t)}},e.prototype.input=function(e,t,r){void 0===t&&(t=null),void 0===r&&(r=0),null==t&&(t=e.length);var i=this.t;i.samples_in+=t,i.input_fifo.write(e,t)},e.prototype.output=function(e){var t=this.t,r=Math.min(e.length,t.output_fifo.occupancy());return t.samples_out+=r,t.output_fifo.read(e,r),r},e.prototype.flush=function(){var e=this.t,t=i(e.samples_in/e.factor+.5),r=t>e.samples_out?t-e.samples_out:0,n=new Float32Array(128*e.channels);if(r>0){for(;e.output_fifo.occupancy()<r;)this.input(n,128),this.process();e.samples_in=0}},e.prototype.setup=function(t,r,n,s,o,a){void 0===n&&(n=!1),void 0===s&&(s=null),void 0===o&&(o=null),void 0===a&&(a=null);var p=1,u=this.t;u.sample_rate=t,null==s&&(s=Math.max(10,e.segments_ms[p]/Math.max(Math.pow(r,e.segments_pow[p]),1))),null==o&&(o=s/e.searches_div[p]),null==a&&(a=s/e.overlaps_div[p]);var f;if(u.quick_search=n,u.factor=r,u.segment=i(t*s/1e3+.5),u.search=i(t*o/1e3+.5),u.overlap=Math.max(i(t*a/1e3+4.5),16),2*u.overlap>u.segment&&(u.overlap-=8),u.is_initialized){var h=new Float32Array(u.overlap*u.channels),l=0;u.overlap*u.channels<u.overlap_buf.length&&(l=u.overlap_buf.length-u.overlap*u.channels),h.set(u.overlap_buf.subarray(l,u.overlap_buf.length)),u.overlap_buf=h}else u.overlap_buf=new Float32Array(u.overlap*u.channels);f=i(Math.ceil(r*(u.segment-u.overlap))),u.process_size=Math.max(f+u.overlap,u.segment)+u.search,u.is_initialized||u.input_fifo.reserve(i(u.search/2)),u.is_initialized=!0},e.prototype.setTempo=function(e){var t=this.t;this.setup(t.sample_rate,e,t.quick_search)},e.segments_ms=[82,82,35,20],e.segments_pow=[0,1,.33,1],e.overlaps_div=[6.833,7,2.5,2],e.searches_div=[5.587,6,2.14,2],e}();window&&(window.Kali=o),e.exports=o},function(e,t){var r=function(){function e(e){this.begin=0,this.end=0,this.typedArrayConstructor=e,this.buffer=new e(16384)}return e.prototype.clear=function(){this.begin=this.end=0},e.prototype.reserve=function(e){for(this.begin==this.end&&this.clear();;){if(this.end+e<this.buffer.length){var t=this.end;return this.end+=e,t}if(this.begin>16384)this.buffer.set(this.buffer.subarray(this.begin,this.end)),this.end-=this.begin,this.begin=0;else{var r=new this.typedArrayConstructor(this.buffer.length+e);r.set(this.buffer),this.buffer=r}}},e.prototype.write=function(e,t){var r=this.reserve(t);this.buffer.set(e.subarray(0,t),r)},e.prototype.write_ptr=function(e){var t=this.reserve(e);return this.buffer.subarray(t,t+e)},e.prototype.read=function(e,t){t+this.begin>this.end&&console.error(\"Read out of bounds\",t,this.end,this.begin),null!=e&&e.set(this.buffer.subarray(this.begin,this.begin+t)),this.begin+=t},e.prototype.read_ptr=function(e,t){return void 0===t&&(t=-1),t>this.occupancy()&&console.error(\"Read Pointer out of bounds\",t),0>t&&(t=this.occupancy()),this.buffer.subarray(this.begin+e,this.begin+t)},e.prototype.occupancy=function(){return this.end-this.begin},e}();e.exports=r}]);\n\n\n// WEBPACK FOOTER //\n// ./js/kali.min.js","import SongFile from './song-file'\r\n\r\nexport default class FileLoader {\r\n\r\n    static loadByUrl(url) {\r\n        return new Promise(function (resolve, reject) {\r\n            var request = new XMLHttpRequest();\r\n            request.open('GET', url);\r\n            request.responseType = 'arraybuffer';\r\n            request.onload = () => {\r\n                let urlParts = url.split('/');\r\n                let fileNamePart = urlParts[urlParts.length - 1];\r\n                let fileNameWithoutExtension = fileNamePart.split('.')[0];\r\n                let songFile = new SongFile(fileNameWithoutExtension, request.response);\r\n                resolve(songFile);\r\n            };\r\n            request.onerror = () => {\r\n                reject({\r\n                    status: this.status,\r\n                    statusText: request.statusText\r\n                });\r\n            };\r\n            request.send();\r\n        });\r\n    }\r\n\r\n    static loadByFileReader(file) {\r\n        return new Promise(function (resolve, reject) {\r\n            var reader = new FileReader();\r\n            reader.onload = (evt) => {\r\n                resolve(new SongFile(file.name.split('.')[0], evt.target.result));\r\n            };\r\n            reader.onerror = () => reject();\r\n            reader.readAsArrayBuffer(file);\r\n        });\r\n    }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./js/file-loader.js","export default class SongFile {\r\n    constructor(fileName, fileData) {\r\n        this.fileName = fileName;\r\n        this.fileData = fileData;\r\n    }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./js/song-file.js","export default class NumberRecogniser {\r\n\r\n    constructor(onNumberRecognised) {\r\n        this.onNumberRecognised = onNumberRecognised;\r\n    }\r\n\r\n    static checkCompatibility() {\r\n        if (!(window.SpeechRecognition || window.webkitSpeechRecognition)) {\r\n            alert('SpeechRecognition is not supported. Please use a compatible browser, eg Chrome.');\r\n            return false;\r\n        }\r\n        var isLocalhost = location.host.startsWith('localhost');\r\n        if (isLocalhost) {\r\n            return true;\r\n        }\r\n        var isChrome = /Chrome/.test(navigator.userAgent) && /Google Inc/.test(navigator.vendor);\r\n        if (isChrome && location.protocol !== 'https:') {\r\n            alert('Chrome requires https for SpeechRecognition. Redirecting now!');\r\n            location.protocol = 'https:';\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    startListening() {\r\n        var recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();\r\n        // recognition.continuous = true;\r\n        // TODO: other languages?\r\n        recognition.lang = 'en-US';\r\n        recognition.interimResults = false;\r\n        recognition.maxAlternatives = 5;\r\n        recognition.start();\r\n\r\n        recognition.onaudioend = ev => {\r\n            // start listening again after audio ends\r\n            this.startListening();\r\n        };\r\n\r\n        recognition.onresult = ev => {\r\n            var results = ev.results[0];\r\n            for (var i = 0; i < results.length; i++) {\r\n                var candidateNumber = Number.parseInt(results[i].transcript);\r\n                if (!Number.isNaN(candidateNumber) && Number.isFinite(candidateNumber)) {\r\n                    this.onNumberRecognised(candidateNumber);\r\n                    // keep listening for more\r\n                    this.startListening();\r\n                    break;\r\n                }\r\n            }\r\n        };\r\n    };\r\n\r\n}\n\n\n// WEBPACK FOOTER //\n// ./js/number-recogniser.js","import SongInfo from './song-info'\r\n\r\nexport default class SongLibrary {\r\n\r\n    constructor() {\r\n        this.songInfos = this.retrieveFromStorage();\r\n    }\r\n\r\n    getSongInfoByName(name) {\r\n        return this.songInfos.get(name);\r\n    }\r\n\r\n    updateSongInfos(songs) {\r\n        for (let i = 0; i < songs.length; i++) {\r\n            // add or update\r\n            this.songInfos.set(songs[i].name, SongInfo.fromObject(songs[i]));\r\n        }\r\n        this.persistToStorage();\r\n    }\r\n\r\n    persistToStorage() {\r\n        // can't serialize Map, so use spread operator to convert to Array\r\n        const json = JSON.stringify([... this.songInfos]);\r\n        localStorage.setItem('song-library', json);\r\n    }\r\n\r\n    retrieveFromStorage() {\r\n        let jsonFromStorage = localStorage.getItem('song-library');\r\n        if (jsonFromStorage) {\r\n            return new Map(JSON.parse(jsonFromStorage));\r\n        }\r\n        else {\r\n            // populate with a default song\r\n            let infos = new Map();\r\n            infos.set('not just jazz', new SongInfo(102));\r\n            return infos;\r\n        }\r\n    }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./js/song-library.js","export default class SongPlayer {\r\n\r\n    constructor(context, buffer, bufferRate, bpm, beatsPerBar) {\r\n        this.context = context;\r\n        this.buffer = buffer;\r\n        this.bpm = bpm;\r\n        this.beatsPerBar = beatsPerBar;\r\n        this.secondsPerBar = this.beatsPerBar * 60 / (bufferRate * bpm);\r\n    }\r\n\r\n    play(barNumber) {\r\n        this.stop();\r\n        let source = this.context.createBufferSource();\r\n        source.buffer = this.buffer;\r\n        source.connect(this.context.destination);\r\n        let startTime = this.getStartTimeInSeconds(barNumber || 0);\r\n        source.start(0, startTime);\r\n        this.currentSource = source;\r\n    }\r\n\r\n    stop() {\r\n        if (this.currentSource) {\r\n            this.currentSource.stop();\r\n        }\r\n    }\r\n\r\n    getStartTimeInSeconds(barNumber) {\r\n        let startTimeInSeconds = ((barNumber - 1) * this.secondsPerBar);\r\n        return Math.max(0, startTimeInSeconds);\r\n    }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./js/song-player.js","import BufferLoader from './buffer-loader'\r\nimport SongLibrary from './song-library'\r\nimport SongPlayer from './song-player'\r\n\r\nexport default class PlaylistManager {\r\n\r\n    constructor(songLibrary) {\r\n        this.songLibrary = songLibrary;\r\n        this.fileDataMap = new Map();\r\n        this.bufferMap = new Map();\r\n        this.context = new (window.AudioContext || window.webkitAudioContext)();\r\n    }\r\n\r\n    addSong(name, fileData) {\r\n        this.fileDataMap.set(name, fileData);\r\n    }\r\n\r\n    playSongByName(songName) {\r\n        let songInfo = this.songLibrary.getSongInfoByName(songName);\r\n        let bufferPlaybackRate = songInfo.playbackRate / 100;\r\n        let bufferKey = songName + '@' + bufferPlaybackRate;\r\n        if (this.bufferMap.has(bufferKey)) {\r\n            let buffer = this.bufferMap.get(bufferKey);\r\n            this._playBuffer(buffer, songInfo);\r\n        }\r\n        else {\r\n            let fileData = this.fileDataMap.get(songName);\r\n            BufferLoader.loadBuffer(fileData, bufferPlaybackRate, p => { console.log('Stretching...', p); })\r\n                .then(buffer => {\r\n                    this.bufferMap.set(bufferKey, buffer);\r\n                    this._playBuffer(buffer, songInfo);\r\n                });\r\n        }\r\n    }\r\n\r\n    jumpToBar(barNumber) {\r\n        if (this.currentSongPlayer) {\r\n            this.currentSongPlayer.play(barNumber);\r\n        }\r\n    }\r\n\r\n    _playBuffer(buffer, songInfo) {\r\n        if (this.currentSongPlayer) {\r\n            this.currentSongPlayer.stop();\r\n        }\r\n        let songPlayer = new SongPlayer(this.context, buffer, songInfo.playbackRate / 100, songInfo.bpm, songInfo.beatsPerBar);\r\n        songPlayer.play();\r\n        this.currentSongPlayer = songPlayer;\r\n    }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./js/playlist-manager.js"],"sourceRoot":""}